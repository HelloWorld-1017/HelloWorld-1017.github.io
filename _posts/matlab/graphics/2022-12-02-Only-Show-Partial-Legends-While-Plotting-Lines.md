---
title: Only Show Partial Legends When Plotting Lines in MATLAB
categories: 
 - MATLAB
tags:
 - MATLAB Graphics
date: 2022-12-02 12:50:47 +0800
last_modified_at: 2025-07-08 23:34:46 +0800
---

# `"HandleVisibility"` property of `Line` object

When plotting lines in MATLAB, sometimes we donâ€™t need to display all the legends of lines. I find some methods on the Internet to meet this requirement, and among which I think the most suitable way is specifying the `"handlevisibility"` property of `Line` object. For example, we could hide the legend of the second green line by the following code: 

```matlab
clc, clear, close all

rng("default")

x = 1:20;
y1 = randn(1, 20);
y2 = randn(1, 20);
y3 = randn(1, 20);

figure
nexttile
hold(gca, "on")
box(gca, "on")
LineWidth = 1.5;
plot(x, y1, "LineWidth", LineWidth, "Color", 'r')
plot(x, y2, "LineWidth", LineWidth, "Color", 'g', "HandleVisibility", 'off')
plot(x, y3, "LineWidth", LineWidth, "Color", 'b')
legend("y1", "y3")
```

<img src="https://github.com/HelloWorld-1017/blog-images/blob/main/migration/imgpersonal/image-20221202125241693.png?raw=true" alt="image-20221202125241693" style="zoom: 67%;" />

<br>

# Label lines by groups

Added on Nov. 14, 2023.
{: .notice--warning}

Sometimes, we need to group lines, and label each group using one legend. Before, I liked to use `"DisplayName"` property to add legend for a single line in each group, and use `"HandleVisibility"` property to hide others, and finally, using `legend()` function to display legends. For example:

<div id="script-1"></div>

```matlab
clc,clear,close all
rng("default")

dataLength = 10;
t = 1:dataLength;
numPerClass = [7,7,7];
data = randn(sum(numPerClass),dataLength);
labels = [repmat("a",numPerClass(1),1);
    repmat("b",numPerClass(2),1);
    repmat("c",numPerClass(3),1)];
Classes = unique(labels);

colors = ["r","g","b"];
figure
hold(gca,"on"),box(gca,"on"),grid(gca,"on")
for i = 1:numel(Classes)
    data_per_class = data(labels==Classes(i),:);
    for j = 1:height(data_per_class)
        if j == 1
            plot(t,data_per_class(j,:),"Color",colors(i),"LineWidth",1.5, ...
                "DisplayName",sprintf("Class %s",Classes(i)))
        else
            plot(t,data_per_class(j,:), ...
                "Color",colors(i),"LineWidth",1.5, ...
                "HandleVisibility","off")
        end
    end
end
legend();
```

<img src="https://raw.githubusercontent.com/HelloWorld-1017/blog-images/main/imgs/202311141552607.png" alt="image-20231114155128765" style="zoom:67%;" />

It could realize our goals, but it is also kinda ugly. Recently, I've been learning MATLAB built-in function `andrewsplot` [^1], and I find it realizing this point by preallocating a `GraphicsPlaceholder` class variable (by `gobjects` function [^2]) and then assigning a `Line` object of each group, which is much better. The specific code is like:

<div id="script-2"></div>

```matlab
clc,clear,close all

rng("default")

dataLength = 10;
t = 1:dataLength;
numPerClass = [7,7,7];
data = randn(sum(numPerClass),dataLength);
labels = [repmat("a",numPerClass(1),1);
    repmat("b",numPerClass(2),1);
    repmat("c",numPerClass(3),1)];
Classes = unique(labels);

colors = ["r","g","b"];
figure
hold(gca,"on"),box(gca,"on"),grid(gca,"on")

% Initialize array for graphics objects with legends
legendh = gobjects(numel(Classes),1);

for i = 1:numel(Classes)
    data_per_class = data(labels==Classes(i),:);
    lines = plot(t,data_per_class,"Color",colors(i),"LineWidth",1.5);
    
    % Store the line object needing legend
    legendh(i) = lines(1);
end
legend(legendh,Classes);
```



<img src="https://raw.githubusercontent.com/HelloWorld-1017/blog-images/main/imgs/202311141555093.png" alt="image-20231114155538996" style="zoom: 67%;" />

The result is the same as that generated by [Script 1](#script-1), but definitely, [Script 2](#script-2) will significantly reduce the code running time especially when the number of lines is very large, because this script avoids many `for` loops and `if` statements. 

On another hand, no matter in [Script 1](#script-1) or [Script 2](#script-2), we all need to specify a uniform color for lines belonging to each group, so we should define a color list in advance, like:

```matlab 
colors = ["r","g","b"];
```

It is okay, but as the number of group increases, it is kinda hard to think about many color names or specific RGB-tuples. Of course, if we want to improve the figure style, specifying RGB-tuples carefully is rather necessary, but at the beginning stage, using built-in colors is a not bad choice. Regarding this point, `andrewsplot` [^1] function also provides an effective approach, that is using `get` method to obtain the `"ColorOrder"` property, i.e., default color list, of the axes. By this way, we could modify [Script 2](#script-2) to: 

<div id="script-3"></div>

```matlab
clc,clear,close all

rng("default")

dataLength = 10;
t = 1:dataLength;
numPerClass = [7,7,7];
data = randn(sum(numPerClass),dataLength);
labels = [repmat("a",numPerClass(1),1);
    repmat("b",numPerClass(2),1);
    repmat("c",numPerClass(3),1)];
Classes = unique(labels);

figure
hold(gca,"on"),box(gca,"on"),grid(gca,"on")

% Obtain buit-in color list
colors = get(gca,"ColorOrder");

% Initialize array for graphics objects with legends
legendh = gobjects(numel(Classes),1);

for i = 1:numel(Classes)
	colorIdx = mod(i-1,height(colors))+1;
    color = colors(colorIdx,:);
    data_per_class = data(labels==Classes(i),:);
    lines = plot(t,data_per_class,"Color",color,"LineWidth",1.5);
    
    % Store the line object needing legend
    legendh(i) = lines(1);
end
legend(legendh,Classes);
```

<img src="https://raw.githubusercontent.com/HelloWorld-1017/blog-images/main/imgs/202311141603639.png" alt="image-20231114160346570" style="zoom: 67%;" />

And a more inspiring aspect in [this script](#script-3) is that we could use modulo operation [^3]:

```matlab
color = colors(mod(i-1,height(colors))+1,:); % the number of colors, i.e.,height(colors), at this case is 7.
```

to determine the color for representing $i$-th group, cause we don't need to concern the case that the number of groups exceeds the number of colors: the modulo operation will make a loop. For example:

| Index of Group (`i`)                       | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   | 16   | 17   | 18   | 19   | 20   | 21   |
| ------------------------------------------ | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| `i-1`                                      | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    | 10   | 11   | 12   | 13   | 14   | 15   | 16   | 17   | 18   | 19   | 20   |
| The Number of Color `height(colors)`       | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    | 7    |
| `mod(i-1,height(colors)`                   | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 0    | 1    | 2    | 3    | 4    | 5    | 6    | 0    | 1    | 2    | 3    | 4    | 5    | 6    |
| Index of Color `mod(i-1,height(colors))+1` | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 1    | 2    | 3    | 4    | 5    | 6    | 7    |

<br>

**References**

[^1]: [`andrewsplot`: Andrews plot](https://ww2.mathworks.cn/help/stats/andrewsplot.html).
[^2]: [`gobjects`: Initialize array for graphics objects](https://ww2.mathworks.cn/help/matlab/ref/gobjects.html).
[^3]: [Modulo](https://en.wikipedia.org/wiki/Modulo).
